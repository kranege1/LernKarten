<!doctype html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>LernKarten Bibliothek ‚Äì Community Decks</title>
	<link rel="stylesheet" href="styles.css">
	<style>
		.library-header {
			text-align: center;
			padding: 48px 20px;
			background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
			color: white;
			margin-bottom: 32px;
		}
		
		.library-header h1 {
			font-size: 2.5rem;
			margin: 0 0 12px 0;
		}
		
		.library-header p {
			font-size: 1.1rem;
			opacity: 0.95;
			margin: 0;
		}
		
		.filters {
			display: flex;
			gap: 16px;
			margin-bottom: 32px;
			flex-wrap: wrap;
			align-items: center;
		}
		
		.filters input {
			flex: 1;
			min-width: 250px;
		}
		
		.filters select {
			min-width: 180px;
		}
		
		.deck-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 24px;
			margin-top: 24px;
		}
		
		.deck-card {
			background: var(--card-bg);
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 24px;
			transition: all 0.3s ease;
			cursor: pointer;
			position: relative;
			overflow: hidden;
		}
		
		.deck-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
			border-color: var(--primary-2);
		}
		
		.deck-card-header {
			margin-bottom: 12px;
		}
		
		.deck-title {
			font-size: 1.3rem;
			font-weight: 600;
			color: var(--text);
			margin: 0 0 8px 0;
		}
		
		.deck-meta {
			display: flex;
			gap: 12px;
			font-size: 0.85rem;
			color: var(--muted);
			margin-bottom: 12px;
		}
		
		.deck-meta span {
			display: flex;
			align-items: center;
			gap: 4px;
		}
		
		.deck-description {
			color: var(--text);
			line-height: 1.6;
			margin-bottom: 16px;
			min-height: 48px;
		}
		
		.deck-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 6px;
			margin-bottom: 16px;
		}
		
		.tag {
			background: rgba(123, 97, 255, 0.1);
			color: var(--primary-2);
			padding: 4px 10px;
			border-radius: 12px;
			font-size: 0.8rem;
			font-weight: 500;
		}
		
		.deck-actions {
			display: flex;
			gap: 8px;
		}
		
		.btn-download {
			flex: 1;
			background: var(--primary);
			color: white;
			border: none;
			padding: 10px 16px;
			border-radius: 8px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		
		.btn-download:hover {
			background: var(--primary-2);
			transform: scale(1.02);
		}
		
		.btn-preview {
			padding: 10px 16px;
			background: rgba(255, 255, 255, 0.05);
			border: 1px solid var(--border);
			border-radius: 8px;
			color: var(--text);
			cursor: pointer;
			transition: all 0.2s ease;
		}
		
		.btn-preview:hover {
			background: rgba(255, 255, 255, 0.1);
		}
		
		.difficulty-badge {
			display: inline-block;
			padding: 4px 12px;
			border-radius: 12px;
			font-size: 0.75rem;
			font-weight: 600;
			text-transform: uppercase;
		}
		
		.difficulty-einfach {
			background: rgba(76, 175, 80, 0.2);
			color: #4CAF50;
		}
		
		.difficulty-mittel {
			background: rgba(255, 193, 7, 0.2);
			color: #FFC107;
		}
		
		.difficulty-schwer {
			background: rgba(244, 67, 54, 0.2);
			color: #F44336;
		}
		
		.empty-state {
			text-align: center;
			padding: 64px 20px;
			color: var(--muted);
		}
		
		.empty-state-icon {
			font-size: 4rem;
			margin-bottom: 16px;
			opacity: 0.5;
		}
		
		.stats-bar {
			display: flex;
			justify-content: center;
			gap: 32px;
			margin: 32px 0;
			padding: 24px;
			background: var(--card-bg);
			border-radius: 12px;
			border: 1px solid var(--border);
		}
		
		.stat-item {
			text-align: center;
		}
		
		.stat-value {
			font-size: 2rem;
			font-weight: 700;
			color: var(--primary-2);
		}
		
		.stat-label {
			font-size: 0.9rem;
			color: var(--muted);
			margin-top: 4px;
		}
		
		.back-link {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			color: var(--primary-2);
			text-decoration: none;
			font-weight: 500;
			margin-bottom: 24px;
			transition: gap 0.2s ease;
		}
		
		.back-link:hover {
			gap: 12px;
		}
	</style>
</head>
<body>
	<div class="library-header">
		<h1>üìö LernKarten Bibliothek</h1>
		<p>Entdecke und lade Community-Decks herunter ‚Äì kostenlos und sofort verf√ºgbar</p>
	</div>
	
	<main class="container">
		<a href="index.html" class="back-link">‚Üê Zur√ºck zur App</a>
		
		<div class="stats-bar">
			<div class="stat-item">
				<div class="stat-value" id="total-decks">0</div>
				<div class="stat-label">Verf√ºgbare Decks</div>
			</div>
			<div class="stat-item">
				<div class="stat-value" id="total-cards">0</div>
				<div class="stat-label">Gesamt Karten</div>
			</div>
			<div class="stat-item">
				<div class="stat-value" id="total-categories">0</div>
				<div class="stat-label">Kategorien</div>
			</div>
		</div>
		
		<div class="filters">
			<input type="text" id="search-input" placeholder="üîç Decks durchsuchen..." />
			<select id="category-filter">
				<option value="">Alle Kategorien</option>
			</select>
			<select id="difficulty-filter">
				<option value="">Alle Schwierigkeiten</option>
				<option value="einfach">Einfach</option>
				<option value="mittel">Mittel</option>
				<option value="schwer">Schwer</option>
			</select>
		</div>
		
		<div id="deck-grid" class="deck-grid"></div>
		
		<div id="empty-state" class="empty-state" style="display: none;">
			<div class="empty-state-icon">üì≠</div>
			<h2>Keine Decks gefunden</h2>
			<p>Versuche einen anderen Suchbegriff oder Filter</p>
		</div>
	</main>
	
	<footer class="app-footer" style="margin-top: 64px;">
		<span class="muted">LernKarten Community ‚Äì Gemeinsam lernen</span>
	</footer>
	
	<script>
		const CATALOG_URL = 'shared-decks/catalog.json';
		let allDecks = [];
		let catalog = null;
		
		// Elemente
		const deckGrid = document.getElementById('deck-grid');
		const emptyState = document.getElementById('empty-state');
		const searchInput = document.getElementById('search-input');
		const categoryFilter = document.getElementById('category-filter');
		const difficultyFilter = document.getElementById('difficulty-filter');
		const totalDecksEl = document.getElementById('total-decks');
		const totalCardsEl = document.getElementById('total-cards');
		const totalCategoriesEl = document.getElementById('total-categories');
		
		// Katalog laden
		async function loadCatalog() {
			try {
				const response = await fetch(CATALOG_URL);
				catalog = await response.json();
				allDecks = catalog.decks || [];
				
				// Statistiken aktualisieren
				updateStats();
				
				// Kategorien-Filter f√ºllen
				populateCategoryFilter();
				
				// Decks anzeigen
				renderDecks(allDecks);
			} catch (error) {
				console.error('Fehler beim Laden des Katalogs:', error);
				deckGrid.innerHTML = '<p class="muted">Fehler beim Laden der Decks. Bitte sp√§ter erneut versuchen.</p>';
			}
		}
		
		// Statistiken aktualisieren
		function updateStats() {
			totalDecksEl.textContent = allDecks.length;
			const totalCards = allDecks.reduce((sum, deck) => sum + (deck.cardCount || 0), 0);
			totalCardsEl.textContent = totalCards;
			const categories = new Set(allDecks.map(d => d.category));
			totalCategoriesEl.textContent = categories.size;
		}
		
		// Kategorien-Filter f√ºllen
		function populateCategoryFilter() {
			const categories = [...new Set(allDecks.map(d => d.category))].sort();
			categories.forEach(cat => {
				const option = document.createElement('option');
				option.value = cat;
				option.textContent = cat;
				categoryFilter.appendChild(option);
			});
		}
		
		// Decks rendern
		function renderDecks(decks) {
			if (decks.length === 0) {
				deckGrid.style.display = 'none';
				emptyState.style.display = 'block';
				return;
			}
			
			deckGrid.style.display = 'grid';
			emptyState.style.display = 'none';
			
			deckGrid.innerHTML = decks.map(deck => `
				<div class="deck-card" data-deck-id="${deck.id}">
					<div class="deck-card-header">
						<h3 class="deck-title">${deck.title}</h3>
						<div class="deck-meta">
							<span>üìä ${deck.cardCount} Karten</span>
							<span class="difficulty-badge difficulty-${deck.difficulty}">${deck.difficulty}</span>
						</div>
					</div>
					<p class="deck-description">${deck.description}</p>
					<div class="deck-tags">
						${(deck.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
					</div>
					<div class="deck-actions">
						<button class="btn-download" onclick="downloadDeck('${deck.downloadUrl}', '${deck.fileName}')">
							üíæ Herunterladen
						</button>
						<button class="btn-preview" onclick="previewDeck('${deck.id}')" title="Vorschau">
							üëÅÔ∏è
						</button>
					</div>
				</div>
			`).join('');
		}
		
		// Deck herunterladen
		async function downloadDeck(url, filename) {
			try {
				const response = await fetch(url);
				const data = await response.json();
				const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
				const downloadUrl = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = downloadUrl;
				a.download = filename;
				document.body.appendChild(a);
				a.click();
				document.body.removeChild(a);
				URL.revokeObjectURL(downloadUrl);
				
				// Feedback
				const btn = event.target;
				const originalText = btn.textContent;
				btn.textContent = '‚úÖ Heruntergeladen!';
				btn.style.background = '#4CAF50';
				setTimeout(() => {
					btn.textContent = originalText;
					btn.style.background = '';
				}, 2000);
			} catch (error) {
				console.error('Download-Fehler:', error);
				alert('Fehler beim Herunterladen. Bitte erneut versuchen.');
			}
		}
		
		// Deck Vorschau (√∂ffnet App mit Import-Dialog)
		function previewDeck(deckId) {
			const deck = allDecks.find(d => d.id === deckId);
			if (deck) {
				// √ñffne App und √ºbergebe Download-URL
				window.location.href = `index.html?import=${encodeURIComponent(deck.downloadUrl)}`;
			}
		}
		
		// Filter anwenden
		function applyFilters() {
			const searchTerm = searchInput.value.toLowerCase();
			const selectedCategory = categoryFilter.value;
			const selectedDifficulty = difficultyFilter.value;
			
			const filtered = allDecks.filter(deck => {
				const matchesSearch = !searchTerm || 
					deck.title.toLowerCase().includes(searchTerm) ||
					deck.description.toLowerCase().includes(searchTerm) ||
					(deck.tags || []).some(tag => tag.toLowerCase().includes(searchTerm));
				
				const matchesCategory = !selectedCategory || deck.category === selectedCategory;
				const matchesDifficulty = !selectedDifficulty || deck.difficulty === selectedDifficulty;
				
				return matchesSearch && matchesCategory && matchesDifficulty;
			});
			
			renderDecks(filtered);
		}
		
		// Event Listener
		searchInput.addEventListener('input', applyFilters);
		categoryFilter.addEventListener('change', applyFilters);
		difficultyFilter.addEventListener('change', applyFilters);
		
		// Initialisierung
		loadCatalog();
	</script>
</body>
</html>
